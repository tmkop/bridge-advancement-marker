<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #timebar {
            position: absolute;
            width: auto;
            height: 30px;
            background: rgba(23, 201, 255, 0.9);
            padding: 5px 10px;
            font-size: 16px;
            font-weight: bold;
            z-index: 10;
            box-sizing: border-box;
            display: none;
        }
        #timeline {
            height: calc(100vh - 30px);
            margin-top: 30px;
            position: relative;
            background: white;
        }
        #people {
            position:relative;
            display: flex;
            flex-direction: column;
        }
        .person {
            position: relative;
            height: 20px;
            display: flex;
            align-items: flex-start;
            padding-left: 0;
            padding-top: 0;
        }
        .person-name {
            position: sticky;
            padding-left: 10px;
            width: fit-content;
            z-index: 4;
            font-weight: bold;
            background:white;
        }
        .person-line {
            position: absolute;
            left: 0px;
            top: 50%;
            right: 0;
            height: 1px;
            background: black;
            transform: translateY(-50%);
        }
        .advancement {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
        .adv-tic {
            width: 1px;
            height: 10px;
            background: black;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
        }
        .adv-circle {
            width: 8px;
            height: 8px;
            background: black;
            border-radius: 50%;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }
        .tooltip {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border: 1px solid black;
            padding: 5px;
            display: none;
            white-space: nowrap;
            z-index: 20;
            font-size: 12px;
        }
        .tooltip .name {
            font-weight: bold;
        }
        .tooltip .desc {
            margin-top: 2px;
        }
        .advancement:hover .tooltip {
            display: block;
        }
    </style>
</head>
<body>
    <div id="timebar"></div>
    <div id="timeline">
        <div id="people">
            <!-- People rows added here -->
        </div>
    </div>
    <script>
        const startTime = new Date('2026-01-01T16:30:00-05:00');

        const timebar = document.getElementById('timebar');
        const timeline = document.getElementById('timeline');
        timeline.style.zIndex = '2';
        document.addEventListener('mousemove', (e) => {
            const vwPerPixel = 100 / window.innerWidth;
            const vwPosition = (timeline.scrollLeft + e.clientX) * vwPerPixel;
            const hours = (vwPosition / 100) * 2;
            const time = new Date(startTime.getTime() + hours * 60 * 60 * 1000);
            timebar.textContent = time.toLocaleString();
            timebar.style.display = 'block';
        });

        const minutesInGameDay = 24; //24 minutes in a game day
        const hoursPerVw = 1 / 100; // hours per vw
        const minorHours = minutesInGameDay / 60 * 1; //1 game day
        const majorHours = minutesInGameDay / 60 * 5; //5 game days
        const minorVw = minorHours / hoursPerVw; 
        const majorVw = majorHours / hoursPerVw;


        function addPerson(name, advancements) {
            const peopleDiv = document.getElementById('people');
            const personDiv = document.createElement('div');
            personDiv.className = 'person';
            
            const nameDiv = document.createElement('div');
            nameDiv.className = 'person-name';
            nameDiv.textContent = name;
            personDiv.appendChild(nameDiv);
            
            const personLine = document.createElement('div');
            personLine.className = 'person-line';
            personDiv.appendChild(personLine);
            
            advancements.forEach((adv, i) => {
                const time = new Date(adv.timestamp);
                const hours = (time - startTime) / (1000 * 60 * 60);
                const position = (hours / 2) * 100; // 100vw per 2 hours
                
                const eventDiv = document.createElement('div');
                eventDiv.className = 'advancement';
                eventDiv.style.left = position + 'vw';
                
                const tic = document.createElement('div');
                tic.className = 'adv-tic';
                eventDiv.appendChild(tic);
                
                const circle = document.createElement('div');
                circle.className = 'adv-circle';
                if (i % 2 === 0) {
                    circle.style.top = '-6px';
                } else {
                    circle.style.bottom = '-6px';
                }
                eventDiv.appendChild(circle);
                
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.innerHTML = `<div class="name">${adv.name}</div><div class="desc">${adv.desc}</div>`;
                eventDiv.appendChild(tooltip);
                
                personDiv.appendChild(eventDiv);
            });
            
            peopleDiv.appendChild(personDiv);
        }

        fetch('2026_advancements.json')
            .then(response => response.json())
            .then(data => {
                const people = {};
                data.messages.forEach(msg => {
                    const desc = msg.embeds[0].description;
                    // Parse name: before "has made the advancement"
                    const nameMatch = desc.match(/^(.+?) has made the advancement/);
                    const name = nameMatch ? nameMatch[1] : 'Unknown';
                    // Parse advancement: after "has made the advancement "
                    const advMatch = desc.match(/has made the advancement (.+)/);
                    const advText = advMatch ? advMatch[1] : '';
                    // Split by first period
                    const periodIndex = advText.indexOf('.');
                    const advancementName = periodIndex !== -1 ? advText.substring(0, periodIndex) : advText;
                    const advancementDesc = periodIndex !== -1 ? advText.substring(periodIndex + 1).trim() : '';
                    if (!people[name]) people[name] = [];
                    people[name].push({
                        timestamp: msg.timestamp,
                        name: advancementName,
                        desc: advancementDesc
                    });
                });
                Object.keys(people).forEach(name => {
                    addPerson(name, people[name]);
                });
                
                const numPeople = Object.keys(people).length;
                
                const allAdv = Object.values(people).flat();
                if (allAdv.length > 0) {
                    const maxTime = Math.max(...allAdv.map(a => new Date(a.timestamp).getTime()));
                    const maxHours = (maxTime - startTime.getTime()) / (1000 * 60 * 60);
                    const bufferHours = 24 / 60;
                    const totalHours = maxHours + bufferHours;
                    const totalVw = (totalHours / 2) * 100;
                    timeline.style.width = totalVw + 'vw';
                    timeline.style.background = `repeating-linear-gradient(to right, transparent ${minorVw - 0.1}vw, rgba(0,0,0,0.2) 0.1vw), repeating-linear-gradient(to right, transparent ${majorVw - 0.2}vw, rgba(0,0,0,0.5) 0.2vw)`;
                    timebar.style.width = totalVw + 'vw';
                    
                    const greenLine = document.createElement('div');
                    greenLine.style.position = 'absolute';
                    greenLine.style.left = ((maxHours / 2) * 100) + 'vw';
                    greenLine.style.top = 0;
                    greenLine.style.width = '2px';
                    greenLine.style.height = '100%';
                    greenLine.style.background = 'green';
                    greenLine.style.zIndex = '3';
                    timeline.appendChild(greenLine);
                    
                    for (let pos = 0; pos < totalVw; pos += minorVw) {
                        const bar = document.createElement('div');
                        bar.style.position = 'absolute';
                        bar.style.left = pos + 'vw';
                        bar.style.top = 0;
                        bar.style.height = '100%';
                        if (pos % majorVw === 0 && pos !== 0) {
                            bar.style.width = '2px';
                            bar.style.background = 'rgba(0,0,0,0.5)';
                        } else if (pos !== 0){
                            bar.style.width = '1px';
                            bar.style.background = 'rgba(0,0,0,0.2)';
                        }
                        barsDiv.appendChild(bar);
                    }
                }

                
            })
            .catch(error => console.error('Error loading advancements:', error));
    </script>
</body>
</html>